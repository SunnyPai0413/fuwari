---
title: 简记一次扫盘经历
published: 2024-03-06
tags:
  - Hardware
category: Zheteng
draft: false
---

简记一次新装SATA机械盘并使用Linux扫盘
A simple note on installing a SATA hard drive and using Linux to check the health statements

### 安装硬盘
#### Install hard drive

硬盘是安装在我的`RD452X`机架服务器上的。前面板有12个盘位，使用SFF8643转$4 \times SATA$线缆连接主板至硬盘背板。
The HDD disk is installed on my `RD452X` rack server. There are 12 disk bays on the front panel, using an SFF8643 to $4 \times SATA$ cable that connects the motherboard to the backplane.

随后，发现上电后无法开机，尝试将背板断电并移除数据线缆、重新插拔PCIe设备和内存条，均无法开机，主板指示灯正常。
After powering up, the device failed to turn on. Despite attempts to power down the backplane, remove data cables, and re-plug PCIe devices and memory sticks, the device remained unresponsive. The motherboard indicator lights appeared normal.

使用RJ45线缆连接Management口和路由器以太网口、在DHCP客户端中查询到地址后，使用另一台计算机成功连接到BMC，并使用带外管理成功启动服务器。初步诊断原因为插拔转接线缆时由于**用力过大**，导致前面板的线缆接口松脱。
After connecting the Management port and Ethernet port of the router with an RJ45 cable and querying the address in the DHCP client, another computer successfully connected to the BMC. The server was then successfully started using out-of-band management. The initial diagnosis suggests that the cable connector on the front panel became loose due to **excessive force** when plugging and unplugging the adapter cable.

> 教训：暴力无法解决问题，大力导致的不会是奇迹。
> Lesson: Violence does not solve problems, and what is achieved by violence will not be miraculous.

### 安装ddrescue
#### Install ddrescue

```bash
dnf install epel-release
dnf install ddrescue
```

### 扫盘
#### Scan the disks

```bash
[root@Backup ~]# lsblk
NAME               MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS
sda                  8:0    0  7.5G  0 disk
├─sda1               8:1    0  600M  0 part /boot/efi
├─sda2               8:2    0    1G  0 part /boot
└─sda3               8:3    0  5.9G  0 part
  ├─almalinux-root 253:0    0  5.1G  0 lvm  /
  └─almalinux-swap 253:1    0  764M  0 lvm  [SWAP]
sdb                  8:16   0 10.9T  0 disk
sdc                  8:32   0 10.9T  0 disk
sdd                  8:48   0 10.9T  0 disk
sde                  8:64   0 10.9T  0 disk
[root@Backup ~]# ddrescue -n -f /dev/sdb /dev/null rescueb.log
GNU ddrescue 1.28
Press Ctrl-C to interrupt
Initial status (read from mapfile)
rescued: 133194 MB, tried: 0 B, bad-sector: 0 B, bad areas: 0

Current status
     ipos:  137872 MB, non-trimmed:        0 B,  current rate:    250 MB/s
     opos:  137872 MB, non-scraped:        0 B,  average rate:    311 MB/s
non-tried:   11862 GB,  bad-sector:        0 B,    error rate:       0 B/s
  rescued:  137872 MB,   bad areas:        0,        run time:         15s
pct rescued:    1.14%, read errors:        0,  remaining time:     10h 33m
                              time since last successful read:          0s
Copying non-tried blocks... Pass 1 (forwards)
```

以上两条命令分别为列出硬盘和扫描硬盘，同时扫描多个硬盘，可以新建多个终端，重复使用ddrescue命令：

```bash
ddrescue -n -f /dev/sdc /dev/null rescuec.log
```

```bash
ddrescue -n -f /dev/sdd /dev/null rescued.log
```

```bash
ddrescue -n -f /dev/sde /dev/null rescuee.log
```

---

### 阵列卡配置

我的阵列卡是`9260-8i`，管理工具下载地址如下：
My raid card is `9260-8i`. The download address of the management tool is:

[~~ftp://tsupport:tsupport@ftp0.broadcom.com/private/MegaRAID/downloads/8.00-05_Linux_MSM.zip~~](ftp://tsupport:tsupport@ftp0.broadcom.com/private/MegaRAID/downloads/8.00-05_Linux_MSM.zip)
[ftp://tsupport:tsupport@ftp0.broadcom.com/private/MegaRAID/downloads/8.00-05_Windows_MSM.zip](ftp://tsupport:tsupport@ftp0.broadcom.com/private/MegaRAID/downloads/8.00-05_Windows_MSM.zip)

Linux版**除了红帽和Debian**系的太**难用了，新手建议使用WinToGo装Windows版
For newcomers, it is recommended to use the Windows version installed with WinToGo, as the Linux version, as well as the **Red Hat or Debian** systems, may be F**king difficult to use.

下载网页是：
Here's the website of the download page:
[https://www.broadcom.com/support/knowledgebase/1211161491782/megaraid-sas-9260-4i---9260-8i---9260de-8i---9261-8i-downloads](https://www.broadcom.com/support/knowledgebase/1211161491782/megaraid-sas-9260-4i---9260-8i---9260de-8i---9261-8i-downloads)

具体配置请自行搜索，也可以无脑点下一步
Please search for specific configurations or follow the next step in the software.

Last updated on Mar. 6th, 2024
SunnyPai